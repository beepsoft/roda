<div id="statistics" class="static-page max-width">
    <h1>Setting up new statistics</h1>

    <p>
        This page provides information on how to configure new statistics based on the information available on the repository. It is important to acknowledge, that in order to understand
        this information one must be an advanced user with knowledge of HTML, CSS and Javascript.
    </p>

    <p>
        Statistics work by sending queries to RODA by means of its API (inspect the API documentation for more information), collecting the results and presenting them as graphics.
        The entire process is done on the client side by Javascript.
    </p>
    <p>
        The following sections provide code snippets that one can use to display statistics about the status of the repository. One just needs to include the code snippets in a new HTML page
        and the included Javascript engine will handle all the communication, workload and presentation. New graphics and statistics can be created by changing the query "data" parameters
        included in the snippets (e.g. data-source-filters).
    </p>

    <h2>AIP Index</h2>
    <h3>Total No. of descriptive records:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
              data-view="text"
              data-view-field="totalCount"
              style="font-size: 3rem; white-space: nowrap;"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h3>Total No. of fonds:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
              data-source-filters="level=fonds"
              data-view="text"
              data-view-field="totalCount"
              style="font-size: 3rem; white-space: nowrap;"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
  data-source-filters="level=fonds"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h3>Distribution of description levels</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
                data-source-facets="level"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="pie"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
        data-source-facets="level"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="pie">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h2>Representations Index</h2>
    <h3>Total No. of Representations:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.ip.IndexedRepresentation"
              data-view="text"
              data-view-field="totalCount"
              style="font-size: 3rem; white-space: nowrap;"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.ip.IndexedRepresentation"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h3>Distribution of representation types</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedRepresentation"
                data-source-facets="type"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="bar"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedRepresentation"
        data-source-facets="type"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="bar">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h2>Files index</h2>
    <h3>Total No. of files:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.ip.IndexedFile"
              data-view="text"
              data-view-field="totalCount"
              style="font-size: 3rem; white-space: nowrap;"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.ip.IndexedFile"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h3>Distribution of mimetypes</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedFile"
                data-source-facets="formatMimetype"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="pie"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedFile"
        data-source-facets="formatMimetype"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="pie">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h3>Distribution of PRONOM IDs</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedFile"
                data-source-facets="formatPronom"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="doughnut"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedFile"
        data-source-facets="formatPronom"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="doughnut">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h2>Job index</h2>
    <h3>Total No. of Ingest jobs:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.jobs.Job"
              data-source-filters="pluginType=INGEST, state=COMPLETED"
              data-source-facets="pluginType"
              data-view="text"
              data-view-field="totalCount"
              style="font-size: 3rem; white-space: nowrap;"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.jobs.Job"
  data-source-filters="pluginType=INGEST, state=COMPLETED"
  data-source-facets="pluginType"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h2>Log index</h2>
    <h3>Total No. of logins:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.log.LogEntry"
              data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login, state=SUCCESS"
              data-view="text"
              data-view-field="totalCount"
              style="font-size: 3rem; white-space: nowrap;"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.log.LogEntry"
  data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login, state=SUCCESS"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h3>Total No. of failed logins:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.log.LogEntry"
              data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login, state=FAILURE"
              data-view="text"
              data-view-field="totalCount"
              style="font-size: 3rem; white-space: nowrap;"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.log.LogEntry"
  data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login, state=FAILURE"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h3>Successful vs failed logins</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.log.LogEntry"
                data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login"
                data-source-facets="state"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="pie"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.log.LogEntry"
        data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login"
        data-source-facets="state"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="pie">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h1>Other charts</h1>

    <h2>Line charts</h2>
    <h3>Description level distribution</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
                data-source-facets="level"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="line"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
        data-source-facets="level"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="line">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h2>Radar charts</h2>
    <h3>Pronom format distribution</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedFile"
                data-source-facets="formatPronom"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="radar"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedFile"
        data-source-facets="formatPronom"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="radar">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h2>Polar area charts</h2>
    <h3>Pronom format distribution</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedFile"
                data-source-facets="formatPronom"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="polarArea"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedFile"
        data-source-facets="formatPronom"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="polarArea">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h2>Custom function to handle facet data</h2>
    <h3>Pronom format distribution</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedFile"
                data-source-facets="formatPronom"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="function"
                data-view-type-function="facetCustomDataHandlerChartOptions"></canvas>
        <script type="text/javascript">
            function facetCustomDataHandlerChartOptions(data, element){
                var options = {};
                var facet = data.facetResults.length > 0 ? data.facetResults[0] : null;
                if (facet) {
                    options = {
                        type: "pie",
                        data: {
                            labels: facet.values.map(function (value) {
                                return value.label;
                            }),
                            datasets: [{
                                label: facet.field,
                                data: facet.values.map(function (value) {
                                    return value.count;
                                }),
                                backgroundColor: facet.values.map(function () {
                                    return rgbaRandomOpaqueColorAsString();
                                })
                            }]
                        },
                        options: {
                            cutoutPercentage: 90,
                            aspectRatio: 1
                        }
                    };
                }
                return options;
            }
        </script>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedFile"
        data-source-facets="formatPronom"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="function"
        data-view-type-function="facetCustomDataHandlerChartOptions">&lt;/canvas>
&lt;script type="text/javascript">
    function facetCustomDataHandlerChartOptions(data, element){
        var options = {};
        var facet = data.facetResults.length > 0 ? data.facetResults[0] : null;
        if (facet) {
            options = {
                type: "pie",
                data: {
                    labels: facet.values.map(function (value) {
                        return value.label;
                    }),
                    datasets: [{
                        label: facet.field,
                        data: facet.values.map(function (value) {
                            return value.count;
                        }),
                        backgroundColor: facet.values.map(function () {
                            return rgbaRandomOpaqueColorAsString();
                        })
                    }]
                },
                options: {
                    cutoutPercentage: 90,
                    aspectRatio: 1
                }
            };
        }
        return options;
    }
&lt;/script>
            </code>
        </pre>
    </div>

    <h2>Custom function to create chart</h2>
    <h3>Bubble chart</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="function"
                data-function="customDataBubbleChart"></canvas>
        <script type="text/javascript">
            function customDataBubbleChart(element) {
                new Chart(element, {
                    type: 'bubble',
                    data: {
                        datasets: [{
                            label: "Test dataset",
                            data: [-3,-2,-1,0,1,2,3].map(function (value) {
                                return {
                                    x: value,
                                    y: value * value,
                                    r: Math.abs(value) * 10
                                };
                            }),
                            backgroundColor: rgbaRandomOpaqueColorAsString(),
                            hoverBackgroundColor: rgbaRandomOpaqueColorAsString()
                        }]
                    }
                });
            }
        </script>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="function"
        data-function="customDataBubbleChart">&lt;/canvas>
&lt;script type="text/javascript">
    function customDataBubbleChart(element) {
        new Chart(element, {
            type: 'bubble',
            data: {
                datasets: [{
                    label: "Test dataset",
                    data: [-3,-2,-1,0,1,2,3].map(function (value) {
                        return {
                            x: value,
                            y: value * value,
                            r: Math.abs(value) * 10
                        };
                    }),
                    backgroundColor: rgbaRandomOpaqueColorAsString(),
                    hoverBackgroundColor: rgbaRandomOpaqueColorAsString()
                }]
            }
        });
    }
&lt;/script>
            </code>
        </pre>
    </div>

</div>
