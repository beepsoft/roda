<div class="static-page max-width help-page">

  <h1>Installing new descriptive metadata formats</h1>

  <p>
    RODA supports any descriptive metadata format (i.e. Descriptive Information as stated in the OAIS) as long as it represented by an XML file. If you have a descriptive metadata format that is not based on XML (e.g. CSV, JSON, MARC21, etc.), you will have to convert it to XML before you can use in RODA. Several tools exist on the Web that allow you to convert most data formats into XML.
  </p>

  <p>
    Once you have your metadata in XML you are ready to package it into a Submission Information Package (SIP) and ingest it on the repository. Alternatively, you may want to create a metadata file directly on the repository by using the functionality provided by the Catalogue. When the metadata format is new to RODA, the repository will do its best to support without the need to do any reconfiguration of system, however, the following limitations apply:

    <p>
      <div class="row full_width">
        <div class="col_3 col_card">
          <h4>Validation</h4>
          <p>If no schema is provided for your metadata format, the repository will check if the metadata XML file is well-formed, however because the repository has no notion of  the right grammar, it will not verify if the file is valid.</p>
        </div>
        <div class="col_3 col_card">
          <h4>Indexing</h4>
          <p>The repository will index all text elements and attribute values found on the metadata file, however because the repository does not know the right mapping between the XML elements and the inner data model, only basic search will possible on the provided metadata.</p>
        </div>
        <div class="col_3 col_card">
          <h4>Visualization</h4>
          <p>When no visualization mappings are configured, a generic metadata viewer will be used the repository to display the XML-based metadata. All text elements and attributes will shown in no particular order and their XPath will be used as the label.</p>
        </div>
        <div class="col_3 col_card">
          <h4>Edition</h4>
          <p>RODA needs a configuration file to inform how metadata files should be displayed for editing purposes. If no such configuration exists, the repository will display a text area where the user is able to edit the XML directly. </p>
        </div>
      </div>
    </p>

    <p>
    In order to support new metadata formats, the repository must be configured accordingly. The following sections describe in detail the set of actions that need to be performed to fully support a new metadata schema in RODA.
    </p>


    <h2>Metadata enhancement files</h2>
    <p>
      To enhance the metadata experience in RODA there are 4 files that need to be added to the repository configuration folders. The following sections describe and provide examples of such files.
    </p>
    <h3>Validation</h3>
    <p>
      RODA uses a <a href="http://www.w3.org/standards/xml/schema"> XML schema </a> to validate the structure and data types of the provided metadata file. The Validation schema will be used during ingest process to check if the metadata included in the SIP is valid according the the established
      constraints, as well as when the metadata is edited via the catalogue.
    </p>
    <p>
      You may use a standard schema file for validation purposes or create a specific one that verifies all the particular conditions that you need to check in your repository installation, e.g. mandatory fields, closed-vocabularies for the values of certain
      elements, etc.
    </p>
    <p>
      The Validation Schema files should be placed on the configuration folder under <code>[RODA_HOME]/config/schemas/</code>.
    </p>

    <p>
      Most metadata formats are published together with documentation and a XML schema. The following example represents the schema for the Simple Dublin Core metadata format:
    </p>
    <p>
      <pre>
    <code class="xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;xs:schema  xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;
            xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot;
            elementFormDefault=&quot;qualified&quot;
            attributeFormDefault=&quot;unqualified&quot;&gt;

  &lt;xs:import namespace=&quot;http://www.w3.org/XML/1998/namespace&quot;
    schemaLocation=&quot;xml.xsd&quot;&gt;
  &lt;/xs:import&gt;

  &lt;xs:complexType name=&quot;SimpleLiteral&quot;&gt;
    &lt;xs:complexContent mixed=&quot;true&quot;&gt;
      &lt;xs:restriction base=&quot;xs:anyType&quot;&gt;
        &lt;xs:sequence&gt;
          &lt;xs:any processContents=&quot;lax&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;0&quot;/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:attribute ref=&quot;xml:lang&quot; use=&quot;optional&quot;/&gt;
      &lt;/xs:restriction&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:element name=&quot;any&quot; type=&quot;SimpleLiteral&quot; abstract=&quot;true&quot;/&gt;

  &lt;xs:element name=&quot;title&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;creator&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;subject&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;description&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;publisher&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;contributor&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;date&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;type&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;format&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;identifier&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;source&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;language&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;relation&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;coverage&quot; substitutionGroup=&quot;any&quot;/&gt;
  &lt;xs:element name=&quot;rights&quot; substitutionGroup=&quot;any&quot;/&gt;

  &lt;xs:group name=&quot;elementsGroup&quot;&gt;
    &lt;xs:sequence&gt;
      &lt;xs:choice minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot;&gt;
        &lt;xs:element ref=&quot;any&quot;/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:group&gt;

  &lt;xs:complexType name=&quot;elementContainer&quot;&gt;
    &lt;xs:choice&gt;
      &lt;xs:group ref=&quot;elementsGroup&quot;/&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:complexType&gt;

   &lt;xs:element name=&quot;simpledc&quot; type=&quot;elementContainer&quot;/&gt;
&lt;/xs:schema&gt;
    </code>
    </pre>
    </p>

    <h3>Indexing</h3>

    <p>
      The <em>Indexing</em> activity is supported by a <a href="http://www.w3.org/standards/xml/transformation.html">XSLT (eXtensible Stylesheet Language Transformations)</a> that transforms the XML-based metadata into something that the indexing engine is able to understand. This file is responsible for selecting the data that is expected to be indexed, map data into specific field names, and instruct the engine on how the data is expected to be indexed based on its data type (i.e. text, number, date, etc.).
    </p>

    <p>
      The Index map file should be added to the configuration folder under <code>[RODA_HOME]/config/crosswalks/ingest/</code>.
    </p>

    <p>
      The following is an example of an Index map for the Simple Dublin Core example.
    </p>
    <p>
      <pre>
    <code class="xml" >
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;xsl:stylesheet version=&quot;2.0&quot;
  xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot;
  exclude-result-prefixes=&quot;dc&quot;&gt;
  &lt;xsl:output method=&quot;xml&quot; indent=&quot;yes&quot; encoding=&quot;UTF-8&quot;
    omit-xml-declaration=&quot;yes&quot; /&gt;

  &lt;xsl:template match=&quot;/&quot;&gt;
    &lt;doc&gt;
      &lt;xsl:apply-templates /&gt;
    &lt;/doc&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:template match=&quot;simpledc&quot;&gt;
    &lt;xsl:if test=&quot;count(title)  &amp;gt; 0&quot;&gt;
      &lt;xsl:if test=&quot;title[1]/text()&quot;&gt;
        &lt;field name=&quot;title&quot;&gt;
          &lt;xsl:value-of select=&quot;title[1]/text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
      &lt;xsl:for-each select=&quot;title&quot;&gt;
        &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
          &lt;field name=&quot;title_txt&quot;&gt;
            &lt;xsl:value-of select=&quot;text()&quot; /&gt;
          &lt;/field&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:for-each&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&quot;count(description)  &amp;gt; 0&quot;&gt;
      &lt;xsl:if test=&quot;description[1]/text()&quot;&gt;
        &lt;field name=&quot;description&quot;&gt;
          &lt;xsl:value-of select=&quot;description[1]/text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
      &lt;xsl:for-each select=&quot;description&quot;&gt;
        &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
          &lt;field name=&quot;description_txt&quot;&gt;
            &lt;xsl:value-of select=&quot;text()&quot; /&gt;
          &lt;/field&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:for-each&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:for-each select=&quot;contributor&quot;&gt;
      &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
        &lt;field name=&quot;contributor_txt&quot;&gt;
          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:for-each select=&quot;coverage&quot;&gt;
      &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
        &lt;field name=&quot;coverage_txt&quot;&gt;
          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:for-each select=&quot;creator&quot;&gt;
      &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
        &lt;field name=&quot;creator_txt&quot;&gt;
          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:if test=&quot;count(date)  &amp;gt; 0&quot;&gt;
      &lt;xsl:if test=&quot;count(date)  &amp;lt; 2&quot;&gt;
        &lt;xsl:analyze-string regex=&quot;^\d{{4}}-\d{{2}}-\d{{2}}$&quot;
        select=&quot;date[1]/text()&quot;&gt;
        &lt;xsl:matching-substring&gt;
          &lt;xsl:variable name=&quot;date&quot;&gt;
            &lt;xsl:value-of select=&quot;regex-group(0)&quot; /&gt;
          &lt;/xsl:variable&gt;
          &lt;xsl:if test=&quot;not(normalize-space($date)=&#39;&#39;)&quot;&gt;
            &lt;field name=&quot;dateInitial&quot;&gt;
              &lt;xsl:value-of select=&quot;$date&quot; /&gt;
              &lt;xsl:text&gt;T00:00:00Z&lt;/xsl:text&gt;
            &lt;/field&gt;
            &lt;field name=&quot;dateFinal&quot;&gt;
              &lt;xsl:value-of select=&quot;$date&quot; /&gt;
              &lt;xsl:text&gt;T00:00:00Z&lt;/xsl:text&gt;
            &lt;/field&gt;
          &lt;/xsl:if&gt;
        &lt;/xsl:matching-substring&gt;
      &lt;/xsl:analyze-string&gt;
      &lt;/xsl:if&gt;
      &lt;xsl:if test=&quot;count(date)  &amp;gt; 1&quot;&gt;
        &lt;xsl:analyze-string regex=&quot;^\d{{4}}-\d{{2}}-\d{{2}}$&quot; select=&quot;date[1]/text()&quot;&gt;
          &lt;xsl:matching-substring&gt;
            &lt;xsl:variable name=&quot;date&quot;&gt;
              &lt;xsl:value-of select=&quot;regex-group(0)&quot; /&gt;
            &lt;/xsl:variable&gt;
            &lt;xsl:if test=&quot;not(normalize-space($date)=&#39;&#39;)&quot;&gt;
              &lt;field name=&quot;dateInitial&quot;&gt;
                &lt;xsl:value-of select=&quot;$date&quot; /&gt;&lt;xsl:text&gt;T00:00:00Z&lt;/xsl:text&gt;
              &lt;/field&gt;
            &lt;/xsl:if&gt;
          &lt;/xsl:matching-substring&gt;
        &lt;/xsl:analyze-string&gt;
        &lt;xsl:analyze-string regex=&quot;^\d{{4}}-\d{{2}}-\d{{2}}$&quot; select=&quot;date[2]/text()&quot;&gt;
          &lt;xsl:matching-substring&gt;
            &lt;xsl:variable name=&quot;date&quot;&gt;
              &lt;xsl:value-of select=&quot;regex-group(0)&quot; /&gt;
            &lt;/xsl:variable&gt;
            &lt;xsl:if test=&quot;not(normalize-space($date)=&#39;&#39;)&quot;&gt;
              &lt;field name=&quot;dateFinal&quot;&gt;
                &lt;xsl:value-of select=&quot;$date&quot; /&gt;
                &lt;xsl:text&gt;T00:00:00Z&lt;/xsl:text&gt;
              &lt;/field&gt;
            &lt;/xsl:if&gt;
          &lt;/xsl:matching-substring&gt;
        &lt;/xsl:analyze-string&gt;
      &lt;/xsl:if&gt;
      &lt;xsl:for-each select=&quot;date&quot;&gt;
        &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
          &lt;field name=&quot;date_txt&quot;&gt;
            &lt;xsl:value-of select=&quot;text()&quot; /&gt;
          &lt;/field&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:for-each&gt;
    &lt;/xsl:if&gt;

    &lt;xsl:for-each select=&quot;format&quot;&gt;
      &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
        &lt;field name=&quot;format_txt&quot;&gt;
          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:for-each select=&quot;identifier&quot;&gt;
      &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
        &lt;field name=&quot;identifier_txt&quot;&gt;
          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:for-each select=&quot;language&quot;&gt;
      &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
        &lt;field name=&quot;language_txt&quot;&gt;
          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:for-each select=&quot;publisher&quot;&gt;
      &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
        &lt;field name=&quot;publisher_txt&quot;&gt;
          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:for-each select=&quot;relation&quot;&gt;
      &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
        &lt;field name=&quot;relation_txt&quot;&gt;
          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:for-each select=&quot;rights&quot;&gt;
      &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
        &lt;field name=&quot;rights_txt&quot;&gt;
          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:for-each select=&quot;source&quot;&gt;
      &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
        &lt;field name=&quot;source_txt&quot;&gt;
          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:for-each select=&quot;subject&quot;&gt;
      &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
        &lt;field name=&quot;subject_txt&quot;&gt;
          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:for-each select=&quot;type&quot;&gt;
      &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
        &lt;field name=&quot;type_txt&quot;&gt;
          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
        &lt;/field&gt;
      &lt;/xsl:if&gt;
    &lt;/xsl:for-each&gt;
    &lt;field name=&quot;level&quot;&gt;item&lt;/field&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
    </code>
    </pre>
    </p>

    <p>
      The output produced by this stylesheet is a <a href="https://wiki.apache.org/solr/UpdateXmlMessages">Solr document</a> ready to be indexed by the RODA search engine. See example bellow:
    </p>

    <p>
      <pre>
    <code class="xml">
&lt;doc&gt;
  &lt;field name=&quot;title&quot;&gt;{{title}}&lt;/field&gt;
  &lt;field name=&quot;title_txt&quot;&gt;{{title}}&lt;/field&gt;
  &lt;field name=&quot;description&quot;&gt;{{description}}&lt;/field&gt;
  &lt;field name=&quot;description_txt&quot;&gt;{{description}}&lt;/field&gt;
  &lt;field name=&quot;creator_txt&quot;&gt;{{creator}}&lt;/field&gt;
&lt;/doc&gt;
    </code>
    </pre>
    </p>


    <h3>Visualization</h3>
    <p>
      The <em>Visualization</em> activity is supported by a <a href="http://www.w3.org/standards/xml/transformation.html">XSLT (eXtensible Stylesheet Language Transformations)</a> that transforms the XML-based metadata file into HTML for presentation purposes. The output of this file is a HTML file will be shown to the user when she browses an existing AIP on the catalogue.
    </p>

    <p>
      The visualization mapping file should be added to the the configuration folder under <code>[RODA_HOME]/config/crosswalks/dissemination/html/</code>.
    </p>
    <p>
      The following example shows how a Simple Dublin Core file can be transformed to HTML for visualization purposes:
    </p>

    <p>
      <pre>
    <code class="xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;xsl:stylesheet version=&quot;2.0&quot;
    xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot;
    exclude-result-prefixes=&quot;dc&quot;&gt;
    &lt;xsl:output method=&quot;xml&quot; indent=&quot;yes&quot; encoding=&quot;UTF-8&quot;
        omit-xml-declaration=&quot;yes&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.title&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.description&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.contributor&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.coverage&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.creator&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.date&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.format&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.identifier&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.language&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.publisher&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.relation&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.rights&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.source&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.subject&quot; /&gt;
    &lt;xsl:param name=&quot;i18n.type&quot; /&gt;



    &lt;xsl:template match=&quot;/&quot;&gt;
        &lt;div class=&quot;descriptiveMetadata&quot;&gt;
            &lt;xsl:apply-templates /&gt;
        &lt;/div&gt;
    &lt;/xsl:template&gt;
    &lt;xsl:template match=&quot;simpledc&quot;&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(title/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.title&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;title&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                  &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(description/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.description&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;description&quot;&gt;
          &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;value&quot;&gt;
              &lt;xsl:value-of select=&quot;text()&quot; /&gt;
            &lt;/div&gt;
          &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(contributor/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.contributor&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;contributor&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                  &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(coverage/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.coverage&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;coverage&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                  &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(creator/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.creator&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;creator&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                  &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(date/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.date&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;date&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                  &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(format/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.format&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;format&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                  &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(identifier/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.identifier&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;identifier&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                  &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(language/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.language&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;language&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                  &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(publisher/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.publisher&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;publisher&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                    &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(relation/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.relation&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;relation&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                    &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(rights/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.rights&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;rights&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                    &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(source/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.source&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;source&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                    &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(subject/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.subject&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;subject&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                  &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
        &lt;xsl:if test=&quot;normalize-space(string-join(type/text(),&#39;&#39;))!=&#39;&#39;&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
                &lt;div class=&quot;label&quot;&gt;
                    &lt;xsl:value-of select=&quot;$i18n.type&quot; /&gt;
                &lt;/div&gt;
                &lt;xsl:for-each select=&quot;type&quot;&gt;
                  &lt;xsl:if test=&quot;normalize-space(text())!=&#39;&#39;&quot;&gt;
                      &lt;div class=&quot;value&quot;&gt;
                          &lt;xsl:value-of select=&quot;text()&quot; /&gt;
                      &lt;/div&gt;
                    &lt;/xsl:if&gt;
                &lt;/xsl:for-each&gt;
            &lt;/div&gt;
        &lt;/xsl:if&gt;
    &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
    </code>
    </pre>

    </p>

    <h3>Editing</h3>
    <p>
      The <em>Editing</em> activity is supported by a configuration file that will instruct the repository on how to display a form to edit existing metadata. The configuration file also serves the purpose of providing a template for creating a new metadata item with some predefined attributes already filled in.
    </p>

    <p>
      Form templates should be added to the configuration under the folder <code>[RODA_HOME]/config/templates/</code>. The following example shows how a template file can be combined with annotations that will be used to render the metadata editor.
    </p>
    <p>
      <pre>
    <code>
{{~field name=&quot;title&quot;   order=&#39;2&#39; auto-generate=&#39;title&#39; label=&quot;{&#39;en&#39;: &#39;Title&#39;}&quot; xpath=&quot;//*:title/string()&quot;}}
{{~field name=&quot;id&quot;      order=&#39;1&#39; auto-generate=&#39;id&#39; label=&quot;{&#39;en&#39;: &#39;ID&#39;}&quot; xpath=&quot;//*:identifier/string()&quot;}}
{{~field name=&quot;creator&quot;   label=&quot;{&#39;en&#39;: &#39;Creator&#39;}&quot; xpath=&quot;//*:creator/string()&quot;}}
{{~field name=&quot;dateInitial&quot; order=&#39;3&#39; type=&#39;date&#39; label=&quot;{&#39;en&#39;: &#39;Initial date&#39;}&quot; xpath=&quot;//*:date[1]/string()&quot;}}
{{~field name=&quot;dateFinal&quot;   order=&#39;4&#39; type=&#39;date&#39; label=&quot;{&#39;en&#39;: &#39;Final date&#39;}&quot; xpath=&quot;//*:date[2]/string()&quot;}}
{{~field name=&quot;description&quot; type=&#39;text-area&#39; label=&quot;{&#39;en&#39;: &#39;Description&#39;}&quot; xpath=&quot;//*:description/string()&quot;}}
{{~field name=&quot;producer&quot;  label=&quot;{&#39;en&#39;: &#39;Producer&#39;}&quot; xpath=&quot;//*:publisher/string()&quot;}}
{{~field name=&quot;rights&quot;    label=&quot;{&#39;en&#39;: &#39;Rights&#39;}&quot; xpath=&quot;//*:rights/string()&quot;}}
{{~field name=&quot;language&quot;  auto-generate=&#39;language&#39; label=&quot;{&#39;en&#39;: &#39;Language&#39;}&quot; xpath=&quot;//*:language/string()&quot;~}}
&lt;?xml version=&quot;1.0&quot;?&gt;

&lt;simpledc xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:noNamespaceSchemaLocation=&quot;../schemas/dc.xsd&quot;&gt;
  &lt;title&gt;{{title}}&lt;/title&gt;
  &lt;identifier&gt;{{id}}&lt;/identifier&gt;
  &lt;creator&gt;{{creator}}&lt;/creator&gt;
  &lt;date&gt;{{dateInitial}}&lt;/date&gt;
  &lt;date&gt;{{dateFinal}}&lt;/date&gt;
  &lt;description&gt;{{description}}&lt;/description&gt;
  &lt;publisher&gt;{{producer}}&lt;/publisher&gt;
  &lt;rights&gt;{{rights}}&lt;/rights&gt;
  &lt;language&gt;{{language}}&lt;/language&gt;
&lt;/simpledc&gt;
    </code>
    </pre>
    </p>


    <p>
      The Form template files are based on the the powerful <a href="http://handlebarsjs.com">Handlebars engine</a>. Each field that is expected to be shown in the metadata editor should be identified in the beginning of the file by a <em>field </em> handle
      (e.g. <code>{{~field name="title"~}}</code>). There are several options that can be used to modify the way each field is displayed. These options are a key-value pairs, e.g. <code>label="Title of work"</code>, where the key is the name of the option
      and the value is the value that will be given to that option.
    </p>
    <p>
      The available options that alter the fields' behavior are:
    </p>

    <ul>
      <li><strong>order</strong> - the order by which the field should be displayed in the metadata editor </li>
      <li><strong>label</strong> - the label of the field to be shown at the left of the value in the editor. The format is a JSON map. The keys of the map are the language ID. Example: {"en": "Title", ""pt_PT": "Título"}"</li>
      <li><strong>labeli18n</strong> - the i18n key for the label of the field (see section "Internationalization of strings" below)</li>
      <li><strong>description</strong> - a text with some help related to the field</li>
      <li><strong>value</strong> - the predefined value of the field</li>
      <li><strong>mandatory</strong> - If set to true the label is styled in bold to draw attention.</li>
      <li><strong>hidden</strong> - if set to true the field is hidden</li>
      <li><strong>xpath</strong> - the xpath of the metadata XML document to which this field should bind to</li>
      <li><strong>auto-generate </strong>- Fills the value with one of the available auto-value generators. Overrides the value option:</li>
      <ul>
        <li><strong>now </strong>- the current date in the format year/month/day</li>
        <li><strong>id </strong>- generates an identifier</li>
        <li><strong>title</strong> - generates a title</li>
        <li><strong>level</strong> - adds the current description level</li>
        <li><strong>parentid</strong> - adds the parent's id, if it exists</li>
        <li><strong>language</strong> - adds the system language, based on the locale. Example: "português" or "English"</li>
      </ul>
      <li><strong>type </strong>- the type of the field. The possible values are:</li>
      <ul>
        <li><strong>text </strong>- text field</li>
        <li><strong>text-area </strong>- Text area. Larger than a field text.</li>
        <li><strong>date </strong>- text field with a date picker</li>
        <li><strong>list </strong>- list with the possible values (combo box)</li>
        <ul>
          <li><strong>options </strong>- List with the possible values that a field can have. This list is a JSonArray. Example: <code>options="[\"final\",\"revised\",\"draft\"]"</code></pre></li>
          <li><strong>optionsLabels </strong>- Map with the labels for each option. The key must match one of the options specified in the "options" list. The entry is another map, mapping a language (key) to a label (value). Example: <code>optionsLabels="{\"final\": {\"en\":\"Final\", \"pt_PT\":\"Final\"},\"revised\": {\"en\":\"Revised\", \"pt_PT\":\"Verificado\"},\"draft\": {\"en\":\"Draft\", \"pt_PT\":\"Rascunho\"}}"</code></li>
          <li><strong>optionsLabelI18nKeyPrefix </strong>- I18n prefix key.  All the key starting with the prefix are used to build the list. Example:<br/><pre><code>optionsLabelI18nKeyPrefix="crosswalks.dissemination.html.ead.level"</code></pre><br/>Properties file:<br/>
          <pre><code>crosswalks.dissemination.html.ead.level.fonds=Fonds
crosswalks.dissemination.html.ead.level.class=Class
crosswalks.dissemination.html.ead.level.collection=Collection
crosswalks.dissemination.html.ead.level.recordgrp=Records group
crosswalks.dissemination.html.ead.level.subgrp=Sub-group
crosswalks.dissemination.html.ead.level.subfonds=Subfonds
crosswalks.dissemination.html.ead.level.series=Series
crosswalks.dissemination.html.ead.level.subseries=Sub-series
crosswalks.dissemination.html.ead.level.file=File
crosswalks.dissemination.html.ead.level.item=Item</code></pre>
          <br/>
          Output:<br/>
          <pre><code>&lt;select&gt;
&lt;option value="fonds"&gt;Fonds&lt;/option&gt;
&lt;option value="class"&gt;Class&lt;/option&gt;
&lt;option value="collection"&gt;Collection&lt;/option&gt;
&lt;option value="recordgrp"&gt;Records group&lt;/option&gt;
(...)
&lt;/select&gt;</code></pre>
          </li>
          <br/>
          <li><strong>Full example of a "list" field</strong>:
          <pre><code>{{~field
name="statusDescription"
order="470"
type="list"
value="final"
options="[\"final\",\"revised\",\"draft\"]"
optionsLabels="{\"final\": {\"en\":\"Final\", \"pt_PT\":\"Final\"},\"revised\": {\"en\":\"Revised\", \"pt_PT\":\"Verificado\"},\"draft\": {\"en\":\"Draft\", \"pt_PT\":\"Rascunho\"}}"
optionsLabelI18nKeyPrefix="crosswalks.dissemination.html.ead.statusDescription"
label="{\"en\": \"Status description\", \"pt_PT\": \"Estado da descrição\"}"
xpath="/*:ead/*:archdesc/*:odd[@type='statusDescription']/*:p/string()"
~}}</code></pre>
          </li>
        </ul>
      </ul>

    </ul>
	<br/>
	<br/>
    <p>
      The following is an example of how the tags can be used:
    </p>
    <p><pre><code>{{~file name="title" order="1" type="text" label="Template title" mandatory="true" auto-generate="title"~}}</code></pre></p></p>

  <h2>Activate the new format</h2>

    After adding all the files described on the previous section, one needs to enable them on the repository. In order to acomplish that, the following activies need to be done.

  <h3>Enable the new metadata format</h3>

  <p>
    After you added the previously described files to your configuration folder, you must enable the new format in the RODA main configuration file.
  </p>
  <p>
    Edit the <code>[RODA_HOME]/config/roda-wui.properties</code> file and add a new entry as the ones shown in the following example with the name of your recently added metadata format. This will make RODA aware of the new metadata format.
  </p>
  <p>
    <pre>
    <code>
ui.browser.metadata.descriptive.types = dc
ui.browser.metadata.descriptive.types = ead_3
ui.browser.metadata.descriptive.types = ead_2002
    </code>
    </pre>
  </p>

  <h3>Internationalization of strings</h3>

  <p>
    In order to have your new metadata schema nicely integrated, your must provide internationalization information (i18n) so that RODA knows how to  display the necessary information on the user interface in the best way possible.
  </p>
  <p>
    Edit the <code>[RODA_HOME]/config/i18n/ServerMessages.properties</code> file and add the following entries as necessary making sure that the last part of the key matches the code provided on the <code>[RODA_HOME]/config/roda-wui.properties</code> file described on the previous section:
  </p>
  <p>
    <pre>
    <code>
ui.browse.metadata.descriptive.type.dc=Dublin Core
ui.browse.metadata.descriptive.type.ead.3=Encoded Archival Description 3
ui.browse.metadata.descriptive.type.ead.2002=Encoded Archival Description 2002
    </code>
    </pre>
  </p>


  <p>
    Finally one should provide translations for the field names to be processed by RODA via the <em> vizualization</em> config file. In order to to that, one must edit the <code>[RODA_HOME]/config/i18n/ServerMessages.properties</code> file and add
    the following entries as necessary, making sure that the last part of the key matches the <code>xsl:params</code>included in the visualization map.
  </p>
  <p>
    The following example depicts how the field names in the Simple Dublin Core example should be displayed in the user interface.
  </p>
  <p>
    <pre>
    <code>
crosswalks.dissemination.html.dc.title=Title
crosswalks.dissemination.html.dc.description=Description
crosswalks.dissemination.html.dc.contributor=Contributor
crosswalks.dissemination.html.dc.coverage=Coverage
crosswalks.dissemination.html.dc.creator=Creator
crosswalks.dissemination.html.dc.date=Date
crosswalks.dissemination.html.dc.format=Format
crosswalks.dissemination.html.dc.identifier=Identifier
crosswalks.dissemination.html.dc.language=Language
crosswalks.dissemination.html.dc.publisher=Publisher
crosswalks.dissemination.html.dc.relation=Relation
crosswalks.dissemination.html.dc.rights=Rights
crosswalks.dissemination.html.dc.source=Source
crosswalks.dissemination.html.dc.rights=Subject
crosswalks.dissemination.html.dc.type=Type
    </code>
    </pre>
  </p>

  <p>
    The previous key endings should match the ones on the xsl:param entries as follows:
  </p>
  <p>
    <pre>
    <code>
&lt;xsl:param name=&quot;i18n.title&quot; /&gt;
&lt;xsl:param name=&quot;i18n.description&quot; /&gt;
&lt;xsl:param name=&quot;i18n.contributor&quot; /&gt;
&lt;xsl:param name=&quot;i18n.coverage&quot; /&gt;
&lt;xsl:param name=&quot;i18n.creator&quot; /&gt;
&lt;xsl:param name=&quot;i18n.date&quot; /&gt;
&lt;xsl:param name=&quot;i18n.format&quot; /&gt;
&lt;xsl:param name=&quot;i18n.identifier&quot; /&gt;
&lt;xsl:param name=&quot;i18n.language&quot; /&gt;
&lt;xsl:param name=&quot;i18n.publisher&quot; /&gt;
&lt;xsl:param name=&quot;i18n.relation&quot; /&gt;
&lt;xsl:param name=&quot;i18n.rights&quot; /&gt;
&lt;xsl:param name=&quot;i18n.source&quot; /&gt;
&lt;xsl:param name=&quot;i18n.subject&quot; /&gt;
&lt;xsl:param name=&quot;i18n.type&quot; /&gt;
    </code>
    </pre>
  </p>

  <h3>Reload configuration</h3>

  <p>
    After changing the configuration files you must restart RODA so that your changes become effective. Do that by restarting your container or your application server.
  </p>

</div>
